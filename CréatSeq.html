<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cr√©ateur de S√©quences Musicales - Julien Sang</title>
    <!-- Favicon SVG int√©gr√© -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%234F46E5'/><path d='M30 60V35l30-7.5v32.5M30 60c0 2.76-3.36 5-7.5 5s-7.5-2.24-7.5-5 3.36-5 7.5-5 7.5 2.24 7.5 5zm30-7.5c0 2.76-3.36 5-7.5 5s-7.5-2.24-7.5-5 3.36-5 7.5-5 7.5 2.24 7.5 5zM30 42.5l30-7.5' stroke='white' stroke-width='3' fill='none'/><circle cx='22.5' cy='60' r='7.5' fill='white'/><circle cx='52.5' cy='52.5' r='7.5' fill='white'/><path d='M70 40c0-5.5 4.5-10 10-10s10 4.5 10 10-4.5 10-10 10' stroke='white' stroke-width='3' fill='none'/><circle cx='80' cy='50' r='3' fill='white'/></svg>" type="image/svg+xml">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Ic√¥nes SVG simples (remplace lucide-react)
        const Icons = {
            Music: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" /></svg>,
            MusicLogo: () => (
                <svg className="w-12 h-12" viewBox="0 0 100 100" fill="none">
                    <rect width="100" height="100" rx="20" fill="url(#gradient)"/>
                    <path d="M30 60V35l30-7.5v32.5M30 60c0 2.76-3.36 5-7.5 5s-7.5-2.24-7.5-5 3.36-5 7.5-5 7.5 2.24 7.5 5zm30-7.5c0 2.76-3.36 5-7.5 5s-7.5-2.24-7.5-5 3.36-5 7.5-5 7.5 2.24 7.5 5zM30 42.5l30-7.5" stroke="white" strokeWidth="3" fill="none"/>
                    <circle cx="22.5" cy="60" r="7.5" fill="white"/>
                    <circle cx="52.5" cy="52.5" r="7.5" fill="white"/>
                    <path d="M70 40c0-5.5 4.5-10 10-10s10 4.5 10 10-4.5 10-10 10" stroke="white" strokeWidth="3" fill="none"/>
                    <circle cx="80" cy="50" r="3" fill="white"/>
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stopColor="#4F46E5"/>
                            <stop offset="50%" stopColor="#7C3AED"/>
                            <stop offset="100%" stopColor="#EC4899"/>
                        </linearGradient>
                    </defs>
                </svg>
            ),
            Plus: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>,
            X: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
            ChevronDown: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>,
            ChevronUp: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7" /></svg>,
            Edit: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>,
            Trash2: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
            Download: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>,
            Save: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V2" /></svg>,
            AlertCircle: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            Search: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>,
            FileText: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
        };

        // Donn√©es compl√®tes
        const objectifsFinCycle = [
            { id: 1, titre: "Mobiliser des techniques vocales et corporelles au service d'un projet d'interpr√©tation ou de cr√©ation", declinaisons: ["Que la voix participe √† la connaissance de son corps", "Que la qualit√© du geste vocal repose sur la ma√Ætrise simultan√©e de plusieurs composantes indispensables √† la mobilisation corporelle : posture, respiration, phonation, r√©sonance", "√Ä en tirer parti pour moduler son expression (timbre, dynamique, phras√©, etc.)", "√Ä imiter un mod√®le puis √† l'interpr√©ter", "√Ä m√©moriser un certain nombre de pi√®ces d'origines vari√©es qui constituent progressivement son r√©pertoire personnel", "√Ä √©couter les diff√©rentes parties musicales tout en situant son propre r√¥le", "√Ä √©couter sa production pour la corriger et la pr√©ciser", "Que l'exigence artistique est aussi n√©cessaire dans l'unisson que dans la polyphonie, dans le chant accompagn√© qu'a capella"] },
            { id: 2, titre: "Identifier, d√©crire, commenter une organisation musicale complexe et la situer dans un r√©seau de r√©f√©rences musicales et artistiques diversifi√©es", declinaisons: ["√Ä se rendre disponible √† la perception des sons et de la musique (silence, concentration)", "√Ä tirer parti de la subjectivit√© de sa perception plut√¥t que d'en rester d√©pendant", "√Ä formuler l'√©tat de sa perception subjective ou objective avec un vocabulaire appropri√© et pour partie sp√©cifique", "√Ä d√©crire, identifier et caract√©riser les √©l√©ments constitutifs du ph√©nom√®ne musical", "√Ä comparer les musiques pour induire, d√©duire et v√©rifier des connaissances qu'il utilisera ensuite dans d'autres contextes", "√Ä mobiliser sa m√©moire sur des objets musicaux de plus en plus longs et complexes", "√Ä analyser son environnement sonore, √† identifier les sources qui le constituent et en comprendre les significations", "Que l'oreille est un instrument intelligent, sensible et souvent virtuose, mais qu'elle est aussi fragile et que son alt√©ration est irr√©versible", "Que l'oreille peut orienter son attention dans une direction particuli√®re, s√©lectionner certaines informations parmi beaucoup d'autres"] },
            { id: 3, titre: "Concevoir, cr√©er et r√©aliser des pi√®ces musicales en r√©f√©rence √† des styles, des ≈ìuvres, des contraintes d'interpr√©tation ou de diffusion", declinaisons: ["Que sa capacit√© √† percevoir nourrit sa capacit√© √† produire et inversement", "Que la sensibilit√© musicale peut varier selon l'√©poque ou la situation g√©ographique du cr√©ateur comme de l'auditeur", "Que la musique t√©moigne toujours de contextes qui la d√©passent, qu'il s'agisse de faits historiques ou d'espaces g√©ographiques", "Que la cr√©ation musicale aujourd'hui est √† la crois√©e de ces diverses influences et traditions, dans tous les cas l'expression d'un contexte original et complexe", "Que toute culture se construit dans un faisceau de traditions et de contraintes et que sa sensibilit√© d√©pend pour une large part de la connaissance des codes, conventions et techniques qui la fondent", "Que la ma√Ætrise individuelle dans un cadre collectif n'a de sens que si elle est partag√©e collectivement", "√Ä improviser dans des cadres d√©finis et/ou sur des carrures br√®ves"] },
            { id: 4, titre: "Pr√©senter et justifier des choix d'interpr√©tation et de cr√©ation, justifier un avis sur une ≈ìuvre et d√©fendre un point de vue en l'argumentant", declinaisons: ["Que sentiment et √©motion sont les r√©v√©lateurs d'une r√©alit√© complexe et permettent de comprendre les significations port√©es par la musique", "Que l'√©motion est un sentiment relatif, propre √† chaque individu, qu'elle ne pr√©sume pas de l'objectivit√© des faits et doit donc √™tre accept√©e pour ce qu'elle est chez lui et chez les autres", "√Ä respecter l'expression de la sensibilit√© de chacun", "√Ä transposer ses connaissances et comp√©tences vers des musiques qu'il √©coute de sa propre initiative", "Que la musique est faite de continuit√©s et de ruptures, d'invariants par-del√† l'histoire et la g√©ographie mais aussi de sp√©cificit√©s qui jalonnent les langages et les esth√©tiques", "Que l'histoire europ√©enne de la musique, si elle se d√©veloppe sur une tr√®s longue dur√©e, s'organise en grandes p√©riodes esth√©tiques"] }
        ];

        const competencesCycle3 = [
            { id: 1, categorie: "Chanter et interpr√©ter", competences: ["Reproduire et interpr√©ter un mod√®le m√©lodique et rythmique", "Chanter une m√©lodie simple avec une intonation juste et une intention expressive", "M√©moriser et chanter par c≈ìur un chant appris par imitation, soutenir un bref moment de chant en solo", "Interpr√©ter un chant avec expressivit√© en respectant plusieurs choix et contraintes pr√©c√©demment indiqu√©s", "Tenir sa partie dans un bref moment de polyphonie", "Mobiliser son corps pour interpr√©ter, le cas √©ch√©ant avec des instruments", "Identifier les difficult√©s rencontr√©es dans l'interpr√©tation d'un chant", "R√©pertoire de chansons diverses", "Param√®tres du son et techniques vocales pour en jouer de fa√ßon expressive", "Vocabulaire de l'expression : quelques nuances simples, tempo, caract√®re, etc‚Ä¶", "Polyphonie : r√¥le compl√©mentaire des parties simultan√©es", "Interpr√©tation d'une musique : compr√©hension du terme et usage appropri√© √† propos d'une ≈ìuvre √©cout√©e et d'une musique produite en classe"] },
            { id: 2, categorie: "√âcouter, comparer et commenter", competences: ["D√©crire et comparer des √©l√©ments sonores issus de contextes musicaux, d'aires g√©ographiques ou culturelles diff√©rents et dans un temps historique, contemporain, proche ou lointain", "Identifier et nommer des ressemblances et diff√©rences dans deux extraits musicaux", "Rep√©rer et nommer une organisation simple dans un extrait musical : r√©p√©tition d'une m√©lodie, d'un motif rythmique, d'un th√®me, d'une partie caract√©ristique, etc. ; en d√©duire une forme simple (couplet/refrain, ABA par exemple)", "Associer la d√©couverte d'une ≈ìuvre √† des connaissances construites dans d'autres domaines enseign√©s", "Vocabulaire simple pour d√©crire la musique", "M√©thodes pour comparer des musiques", "Rep√®res simples dans le temps et dans l'espace", "Quelques grandes ≈ìuvres du patrimoine", "Principales caract√©ristiques de l'orchestre symphonique", "Formes de production vari√©es : vocales, instrumentales, solistes"] },
            { id: 3, categorie: "Explorer, imaginer et cr√©er", competences: ["Exp√©rimenter les param√®tres du son et en imaginer en cons√©quence des utilisations possibles", "Imaginer des repr√©sentations graphiques pour organiser une succession de sons et d'√©v√©nements sonores", "Inventer une organisation simple √† partir de sources sonores s√©lectionn√©es (dont la voix) et l'interpr√©ter", "D√©veloppement du lexique pour d√©crire le son instrumental, le son vocal et les objets sonores dans les domaines de la hauteur, du timbre, de la dur√©e, de l'intensit√©", "Diversit√© des mat√©riaux sonores et cat√©gories class√©es par caract√©ristiques dominantes", "Les postures de l'explorateur du son puis du compositeur : produire, √©couter, trier, choisir, organiser, composer", "Le projet graphique (partition adapt√©e pour organiser la m√©moire) et sa traduction sonore", "Les exigences de la musique collective : √©coute de l'autre, respect de ses propositions"] },
            { id: 4, categorie: "√âchanger, partager et argumenter", competences: ["Exprimer ses go√ªts au-del√† de son ressenti imm√©diat", "√âcouter et respecter le point de vue des autres et l'expression de leur sensibilit√©", "Argumenter un jugement sur une musique tout en respectant celui des autres", "Argumenter un choix dans la perspective d'une interpr√©tation collective", "Notions de respect, de bienveillance, de tol√©rance", "Vocabulaire adapt√© √† l'expression et l'argumentation de son point de vue personnel sur la musique", "Conditions d'un travail collectif : concentration, √©coute, respect, auto√©valuation, etc‚Ä¶", "R√®gles et contraintes du travail musical collectif visant l'expression d'un avis partag√© comme une production sonore de qualit√©"] }
        ];

        const competencesCycle4 = [
            { id: 1, categorie: "R√©aliser des projets musicaux d'interpr√©tation ou de cr√©ation", competences: ["D√©finir les caract√©ristiques musicales d'un projet, puis en assurer la mise en ≈ìuvre en mobilisant les ressources adapt√©es", "D√©finir les caract√©ristiques expressives d'un projet, puis en assurer la mise en ≈ìuvre", "R√©aliser des projets musicaux dans un cadre collectif (classe) en petit groupe ou individuellement", "Interpr√©ter un projet devant d'autres √©l√®ves et pr√©senter les choix artistiques effectu√©s", "Tenir sa partie dans un contexte polyphonique", "R√©pertoire de projets relevant d'esth√©tiques diverses (chanson actuelle, du patrimoine non occidental ; air d'op√©ra, de com√©die musicale, m√©lodie, etc.)", "Vocabulaire et techniques de l'interpr√©tation et de l'expression musicales (domaines de la dynamique, du phras√©, du timbre, du rythme, de la hauteur, de la forme, etc.)", "Outils num√©riques simples pour capter les sons (enregistrement), les manipuler (timbre) et les organiser dans le temps (s√©quence)", "D√©marches de cr√©ation : chanson sur texte ou musique pr√©existants ; notions de prosodie"] },
            { id: 2, categorie: "√âcouter, comparer, construire une culture musicale commune", competences: ["Mobiliser sa m√©moire sur des objets musicaux longs et complexes", "Situer et comparer des musiques de styles proches ou √©loign√©s dans l'espace et/ou dans le temps pour construire des rep√®res techniques et culturels", "Mettre en lien des caract√©ristiques musicales et des marqueurs esth√©tiques avec des contextes historiques, sociologiques, techniques et culturels", "Mobiliser des rep√®res permettant d'identifier les principaux styles musicaux", "Associer des r√©f√©rences relevant d'autres domaines artistiques aux ≈ìuvres musicales √©tudi√©es", "Identifier par comparaison les diff√©rences et ressemblances dans l'interpr√©tation d'une ≈ìuvre donn√©e", "Percevoir et d√©crire les qualit√©s artistiques et techniques d'un enregistrement", "Manipuler plusieurs formes de repr√©sentation graphique de la musique √† l'aide d'outils num√©riques", "Lexiques du langage musical", "Grandes cat√©gories musicales", "Quelques grandes ≈ìuvres musicales repr√©sentatives", "Ensemble de rep√®res relatifs √† l'histoire de la musique", "Conscience de la diversit√© des cultures", "Diversit√© des postures du m√©lomane", "Fonctions de la musique dans la soci√©t√©", "Apports du num√©rique", "Rep√®res sur le monde professionnel", "Physiologie de l'audition", "Environnement sonore", "Notions d'acoustique"] },
            { id: 3, categorie: "Explorer, imaginer, cr√©er et produire", competences: ["Production : R√©utiliser certaines caract√©ristiques d'une ≈ìuvre connue", "Production : Concevoir, r√©aliser, arranger une pi√®ce", "Production : Identifier les leviers d'am√©lioration", "Production : Mobiliser un syst√®me de codage", "Production : S'auto√©valuer", "Perception : Mobiliser les ressources documentaires", "Perception : R√©investir ses exp√©riences de cr√©ation", "Perception : Concevoir une playlist", "Perception : S'auto√©valuer"] },
            { id: 4, categorie: "√âchanger, partager, argumenter et d√©battre", competences: ["Production : D√©velopper une critique constructive", "Production : Porter un regard critique", "Production : Contribuer aux choix collectifs", "Production : Transf√©rer les conclusions d'un d√©bat", "Perception : Probl√©matiser l'√©coute", "Perception : Distinguer subjectif et objectif", "Perception : Argumenter une critique", "Perception : Respecter la sensibilit√©", "Perception : S'enrichir de la diversit√©", "Perception : Distinguer les postures"] }
        ];

        const domainesTechniques = {
            1: { titre: "Geste vocal", declinaisons: ["Assurer la posture: enracinement, axe vertical, ouverture, d√©contraction", "Ma√Ætriser la respiration: d√©tente inspiratoire, tonicit√© de l'expiration", "Soigner l'attaque, le soutien, la coupure du son, et am√©liorer l'intonation", "Chanter des sons conjoints et disjoints", "D√©velopper la tessiture, d√©couvrir les registres et choisir le registre adapt√©", "Moduler son articulation (d√©bit, consonnes percussives...), son accentuation (dynamique, rythmique) et son phras√©", "Moduler sa dynamique (intensit√© du son, intensit√© du geste)", "Moduler son timbre (sons vois√©s et non vois√©s; consonnes nasales ; homog√©n√©iser les couleurs des voyelles dans le groupe, d√©velopper la richesse harmonique)", "Identifier des marqueurs stylistiques dans l'utilisation de la voix", "Pr√©venir les risques vocaux", "Se concentrer", "√âcouter le mod√®le vocal, le contexte, le r√©sultat", "Imiter et m√©moriser un mod√®le rythmique/m√©lodique", "Corriger son intonation en s'aidant du contexte harmonique", "Adapter, anticiper la prise d'air et le soutien en fonction du contexte (texte, phrase, tempo...)", "Percevoir, tenir, animer une pulsation", "Traduire par le corps, le geste, la voix une carrure (temps forts, temps faibles)", "Respecter la division du temps (binaire, ternaire)", "Respecter les d√©calages rythmiques (anacrouse, syncope)", "Tenir sa partie dans un contexte polyphonique, polyrythmique ou h√©t√©rophonique", "Chanter de m√©moire le r√©pertoire travaill√©", "Faire attention √† soi, aux autres", "√âcouter et coordonner son geste vocal avec celui des autres", "Chanter en classe, en petit groupe, individuellement (partie soliste)", "Mobiliser les notions et techniques des diff√©rents domaines pour enrichir sa production vocale", "Identifier les difficult√©s d'une situation vocale et mobiliser les techniques pour y rem√©dier", "Mobiliser les ressources vocales n√©cessaires √† une expression particuli√®re", "Interpr√©ter plut√¥t qu'imiter un mod√®le", "Arranger, pasticher un mod√®le", "Inventer un √©l√©ment original pour enrichir la r√©alisation d'un projet musical", "R√©utiliser certaines caract√©ristiques (style, technique, etc.) d'une ≈ìuvre connue", "Faire preuve d'autonomie et d'initiative dans l'interpr√©tation tout en respectant les choix collectifs", "R√©investir ses exp√©riences personnelles de la cr√©ation musicale pour √©laborer un projet", "Identifier, rechercher et mobiliser √† bon escient les ressources documentaires enregistr√©es pour nourrir la r√©alisation d'un projet"] },
            2: { titre: "Style", declinaisons: ["Une musique populaire d'une musique savante", "Une musique sacr√©e d'une musique profane", "Une musique de circonstance (f√™te, c√©r√©monie, hommage, comm√©moration)", "Une musique traditionnelle", "Une musique accompagnant l'image fixe ou anim√©e (cin√©ma, audiovisuel, multim√©dia)", "Une musique de consommation (publicit√© sous toutes ses formes)", "Une musique ¬´ pure ¬ª", "Une musique au service du mouvement et de la sc√®ne (danse, ballet)", "Une musique dans diff√©rentes interpr√©tations ou arrangements", "Une musique narrative, descriptive ou figurative", "Une musique de spectacle vivant (interpr√®tes et auditeurs en pr√©sence)", "Une musique occidentale d'une musique non occidentale", "Deux styles de musique de r√©gions de France", "Deux styles de musiques de diff√©rents continents", "Un collage musical et l'origine des cultures ou styles juxtapos√©s", "Un m√©tissage et l'origine des cultures m√©tiss√©es", "Deux styles de musique de p√©riodes chronologiques √©loign√©es l'une de l'autre", "Deux styles de musique de p√©riodes chronologiques proches", "Un style de musique caract√©ristique d'une √©poque de l'histoire des arts", "Diff√©rents styles et diff√©rentes √©poques dans une m√™me ≈ìuvre"] },
            3: { titre: "Timbre et espace", declinaisons: ["Bruit et son", "Le registre, la hauteur", "L'enveloppe du son: attaque (plus particuli√®rement), entretien, chute", "La richesse harmonique (le spectre)", "Espace et densit√© sonore (du soliste √† la formation ch≈ìur et orchestre et √† la musique mixte)", "Timbre et qualit√© de la texture", "Par les techniques et les modes de jeu", "Par superposition des couleurs sonores", "Par fusion de timbres", "Par des effets divers, d'origine m√©canique (sourdine) ou √©lectronique et num√©rique", "Par l'acoustique du lieu de production et de diffusion", "Par la diffusion sur haut-parleurs", "En interaction avec les autres composantes, m√©lodie, rythme, harmonie, dynamique", "Par r√©partition et organisation temporelles des masses sonores", "Par r√©partition et organisation spatiales des masses sonores"] },
            4: { titre: "Dynamique", declinaisons: ["Son brut", "Intensit√© du son et intensit√© du geste", "Diff√©rentes nuances (de pianissimo √† fortissimo)", "√âvolution progressive de l'intensit√© (crescendo, decrescendo)", "Intensit√© stable ou contrast√©e", "Accentuation", "Diversit√© des modes de jeu", "Densit√© du son (de une √† plusieurs sources sonores jouant les m√™mes sons)", "Potentialit√© des grandes cat√©gories de formation (instrument seul, combo jazz, orchestre, etc.)", "Musique acoustique ou amplifi√©e", "En compressant le son (processus li√© √† l'enregistrement / √† la diffusion)", "Par des ruptures ou des √©volutions de la dynamique", "En soulignant les √©l√©ments structurant le temps", "En diff√©renciant les fonctions musicales compl√©mentaires", "En changeant les modes de jeu", "En variant l'instrumentation et l'orchestration", "En jouant sur l'amplification"] },
            5: { titre: "Temps et rythme", declinaisons: ["Temps non puls√© - lisse, ou temps puls√© - stri√©", "Pulsation", "Tempo", "Dur√©es et densit√© rythmique", "Accentuations", "Temps forts et faibles, carrure", "Respiration et d√©calage (anacrouse et syncope)", "Temps binaire et temps ternaire", "Formules rythmiques simples et structurantes", "Gestes musicaux (ou Unit√©s s√©miotiques temporelles [UST]) : √©lan, √©tirement, chute etc.", "Par des ruptures ou des √©volutions de tempo", "Par la modification des dur√©es d'un motif structurant", "Par l'accentuation d'√©l√©ments de nature m√©lodique", "Par le d√©calage des appuis attendu: (syncope)", "Par des changements de carrure", "Par la superposition de rythmes compl√©mentaires", "Par la superposition de rythmes de carrures diff√©rentes", "Par opposition des diff√©rents tempos d'une ≈ìuvre", "Par opposition de diff√©rentes m√©triques et carrures", "Par la pr√©sentation modul√©e d'une formule rythmique d'accompagnement"] },
            6: { titre: "Forme", declinaisons: ["Identification d'un √©l√©ment structurant (th√®me, cellule, motif, rythme, etc.)", "Alternance de continuit√©s et de ruptures", "Ruptures de diff√©rentes natures (m√©lodique, rythmique, harmonique, dynamique, de timbre, etc.)", "Progressions par paliers (relevant des hauteurs, de la dynamique, du timbre de l'espace, etc.)", "Des marqueurs r√©currents (relatifs la dynamique, au rythme, √† la m√©lodie, au timbre, √† l'espace, √† l'harmonie, etc.)", "En installant un ordre par : Parties, Th√®mes, Motifs", "En installant des relations : D'identit√©, De ressemblance, De diff√©rence", "En organisant des traitements de : R√©p√©tition, Citation, Variation, D√©veloppement", "Par addition (forme strophique, forme √† couplets et refrain)", "Par r√©p√©tition diff√©r√©e (ABA, rondo, etc.)", "Par variation (sur basse obstin√©e, sur th√®me, sur grille harmonique)", "Par al√©as (forme ouverte, improvisation)", "Par argument extra musical (musique √† programme)"] },
            7: { titre: "Successif et simultan√©", declinaisons: ["Suite de sons conjoints ; suite de sons disjoints ; combinaisons", "R√©p√©tition d'un motif simple rythmique et/ou m√©lodique", "Caract√®re suspensif ou conclusif d'une ligne m√©lodique", "Accords, agr√©gats, clusters", "Plans sonores et fonctions musicales", "Polyphonie, polyrythmie, h√©t√©rophonie", "Par r√©currence simple d'un motif (ostinato, basse obstin√©e, etc.)", "Par r√©currence vari√©e d'un motif (variations)", "Par imitation", "Par accumulation", "Par d√©veloppement", "Par association de fonctions (ligne m√©lodique principale et accompagnement, etc.)", "Par montage, par mixage (tuilage, fondu encha√Æn√©, etc.)", "Par le travail th√©matique", "Par des tensions et d√©tentes harmoniques", "Par des cadences", "Par l'organisation tonale, atonale, modale", "Par des superpositions (doublures diverses)", "Par des ponctuations de diverses natures"] }
        };

        function MusicSequenceBuilder() {
            const [sequences, setSequences] = useState(() => {
                const saved = localStorage.getItem('musicSequences');
                return saved ? JSON.parse(saved) : [];
            });

            const [currentSequence, setCurrentSequence] = useState({
                titre: '', niveau: '', cycle: '', numeroSequence: '1', question: '', problematique: '',
                declinaisonsSelectionnees: [], competencesDeclinaisons: [], domainesDeclinaisons: [],
                vocabulaire: [], oeuvreReference: '', oeuvresComplementaires: ['', '', ''],
                projetMusical: '', histoireDesArts: '', duree: '4'
            });

            const [ui, setUi] = useState({
                showForm: false, showCycleSelection: true, showObjectifs: false, showCompetences: false,
                currentCycle: '', expandedObjectif: null, expandedCompetence: null, expandedDomaine: null,
                searchTerm: '', editingId: null, filterNiveau: '', showProgression: false
            });

            const [newVocabulaire, setNewVocabulaire] = useState('');
            const [expandedSequences, setExpandedSequences] = useState({});

            useEffect(() => {
                localStorage.setItem('musicSequences', JSON.stringify(sequences));
            }, [sequences]);

            const handleSelectCycle = (niveau) => {
                const cycle = niveau === '6√®me' ? 'Cycle 3' : 'Cycle 4';
                setCurrentSequence({ ...currentSequence, niveau, cycle });
                setUi({ ...ui, currentCycle: cycle, showCycleSelection: false });
            };

            const handleDeleteSequence = (id, titre) => {
                if (window.confirm(`Supprimer la s√©quence "${titre}" ?`)) {
                    setSequences(sequences.filter(s => s.id !== id));
                }
            };

            const handleEditSequence = (sequence) => {
                setCurrentSequence(sequence);
                setUi({
                    ...ui,
                    showForm: true,
                    showCycleSelection: false,
                    showObjectifs: false,
                    showCompetences: false,
                    currentCycle: sequence.cycle,
                    editingId: sequence.id
                });
            };

            const handleExportPDF = (sequence) => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                let y = 20;
                const lineHeight = 7;
                const pageHeight = 280;
                
                // Fonction helper pour ajouter du texte avec gestion des pages
                const addText = (text, fontSize = 12, isBold = false) => {
                    doc.setFontSize(fontSize);
                    doc.setFont(undefined, isBold ? 'bold' : 'normal');
                    
                    const lines = doc.splitTextToSize(text, 170);
                    lines.forEach(line => {
                        if (y > pageHeight) {
                            doc.addPage();
                            y = 20;
                        }
                        doc.text(line, 20, y);
                        y += fontSize === 16 ? 10 : lineHeight;
                    });
                };

                // Titre
                addText('S√âQUENCE P√âDAGOGIQUE MUSICALE', 16, true);
                y += 5;

                // Informations g√©n√©rales
                addText('INFORMATIONS G√âN√âRALES', 14, true);
                addText(`Niveau : ${sequence.niveau}`, 11);
                addText(`Cycle : ${sequence.cycle}`, 11);
                addText(`S√©quence n¬∞ : ${sequence.numeroSequence}`, 11);
                addText(`Dur√©e : ${sequence.duree} s√©ances`, 11);
                addText(`Titre : ${sequence.titre}`, 11);
                if (sequence.question) addText(`Question directrice : ${sequence.question}`, 11);
                if (sequence.problematique) addText(`Probl√©matique : ${sequence.problematique}`, 11);
                y += 5;

                // Objectifs
                if (sequence.declinaisonsSelectionnees && sequence.declinaisonsSelectionnees.length > 0) {
                    addText('OBJECTIFS ET ATTENDUS DE FIN DE CYCLE', 14, true);
                    sequence.declinaisonsSelectionnees.forEach(key => {
                        const [objId, ...decParts] = key.split('-');
                        const objectif = objectifsFinCycle.find(o => o.id === parseInt(objId));
                        if (objectif) {
                            addText(`Objectif ${objId} : ${objectif.titre}`, 11, true);
                            addText(`‚Üí ${decParts.join('-')}`, 10);
                        }
                    });
                    y += 5;
                }

                // Comp√©tences
                if (sequence.competencesDeclinaisons && sequence.competencesDeclinaisons.length > 0) {
                    addText('COMP√âTENCES TRAVAILL√âES', 14, true);
                    sequence.competencesDeclinaisons.forEach(key => {
                        const [compId, ...decParts] = key.split('-');
                        const competences = sequence.cycle === 'Cycle 3' ? competencesCycle3 : competencesCycle4;
                        const comp = competences.find(c => c.id === parseInt(compId));
                        if (comp) {
                            addText(`${comp.categorie}`, 11, true);
                            addText(`‚Üí ${decParts.join('-')}`, 10);
                        }
                    });
                    y += 5;
                }

                // Domaines techniques
                if (sequence.domainesDeclinaisons && sequence.domainesDeclinaisons.length > 0) {
                    addText('DOMAINES TECHNIQUES', 14, true);
                    sequence.domainesDeclinaisons.forEach(key => {
                        const [domId, ...decParts] = key.split('-');
                        const domaine = domainesTechniques[domId];
                        if (domaine) {
                            addText(`${domaine.titre}`, 11, true);
                            addText(`‚Üí ${decParts.join('-')}`, 10);
                        }
                    });
                    y += 5;
                }

                // Vocabulaire
                if (sequence.vocabulaire && sequence.vocabulaire.length > 0) {
                    addText('VOCABULAIRE', 14, true);
                    addText(sequence.vocabulaire.join(', '), 10);
                    y += 5;
                }

                // ≈íuvres
                if (sequence.oeuvreReference) {
                    addText('≈íUVRE DE R√âF√âRENCE', 14, true);
                    addText(sequence.oeuvreReference, 10);
                    y += 5;
                }

                if (sequence.oeuvresComplementaires && sequence.oeuvresComplementaires.filter(o => o).length > 0) {
                    addText('≈íUVRES COMPL√âMENTAIRES', 14, true);
                    sequence.oeuvresComplementaires.filter(o => o).forEach(oeuvre => {
                        addText(`‚Ä¢ ${oeuvre}`, 10);
                    });
                    y += 5;
                }

                // Projet musical
                if (sequence.projetMusical) {
                    addText('PROJET MUSICAL', 14, true);
                    addText(sequence.projetMusical, 10);
                    y += 5;
                }

                // Histoire des Arts
                if (sequence.histoireDesArts) {
                    addText('HISTOIRE DES ARTS', 14, true);
                    addText(sequence.histoireDesArts, 10);
                }

                // Date de cr√©ation et cr√©ateur
                y += 10;
                const date = new Date().toLocaleDateString('fr-FR');
                addText(`Document g√©n√©r√© le ${date}`, 8);
                addText(`Cr√©√© avec l'outil de Julien Sang`, 8);

                // Sauvegarder le PDF
                doc.save(`sequence_${sequence.niveau}_${sequence.numeroSequence}.pdf`);
            };

            const handleExportSequence = (sequence) => {
                const dataStr = JSON.stringify(sequence, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `sequence_${sequence.niveau}_${sequence.numeroSequence}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            };

            const toggleDeclinaison = (type, id, value) => {
                const key = `${id}-${value}`;
                const field = type === 'objectifs' ? 'declinaisonsSelectionnees' : `${type}Declinaisons`;
                const current = currentSequence[field] || [];
                const maxValues = type === 'objectifs' ? 3 : type === 'competences' ? 4 : 100;
                
                if (current.includes(key)) {
                    setCurrentSequence({ ...currentSequence, [field]: current.filter(d => d !== key) });
                } else if (current.length < maxValues) {
                    setCurrentSequence({ ...currentSequence, [field]: [...current, key] });
                }
            };

            const handleSaveSequence = () => {
                // V√©rifier les conditions obligatoires
                const hasGesteVocal = currentSequence.domainesDeclinaisons.some(d => d.startsWith('1-'));
                const hasStyle = currentSequence.domainesDeclinaisons.some(d => d.startsWith('2-'));
                
                if (!hasGesteVocal || !hasStyle) {
                    alert('Attention ! Vous devez s√©lectionner au moins :\n- 1 √©l√©ment dans "Geste vocal" (domaine 1)\n- 1 √©l√©ment dans "Style" (domaine 2)');
                    return;
                }
                
                if (currentSequence.titre && currentSequence.competencesDeclinaisons.length >= 3) {
                    const newSequence = { ...currentSequence, id: ui.editingId || Date.now() };
                    
                    if (ui.editingId) {
                        setSequences(sequences.map(s => s.id === ui.editingId ? newSequence : s));
                    } else {
                        setSequences([...sequences, newSequence]);
                    }
                    
                    setCurrentSequence({
                        titre: '', niveau: '', cycle: '', numeroSequence: '1', question: '', problematique: '',
                        declinaisonsSelectionnees: [], competencesDeclinaisons: [], domainesDeclinaisons: [],
                        vocabulaire: [], oeuvreReference: '', oeuvresComplementaires: ['', '', ''],
                        projetMusical: '', histoireDesArts: '', duree: '4'
                    });
                    
                    setUi({ ...ui, showForm: false, showCycleSelection: true, showObjectifs: false, 
                             showCompetences: false, currentCycle: '', editingId: null });
                }
            };

            const filteredSequences = sequences.filter(seq => {
                // Filtre par recherche textuelle
                const searchLower = ui.searchTerm.toLowerCase();
                const matchesSearch = !ui.searchTerm || 
                    seq.titre.toLowerCase().includes(searchLower) ||
                    seq.niveau.toLowerCase().includes(searchLower) ||
                    (seq.question && seq.question.toLowerCase().includes(searchLower)) ||
                    (seq.problematique && seq.problematique.toLowerCase().includes(searchLower)) ||
                    (seq.oeuvreReference && seq.oeuvreReference.toLowerCase().includes(searchLower)) ||
                    (seq.projetMusical && seq.projetMusical.toLowerCase().includes(searchLower)) ||
                    (seq.vocabulaire && seq.vocabulaire.some(v => v.toLowerCase().includes(searchLower)));
                
                // Filtre par niveau
                const matchesNiveau = !ui.filterNiveau || seq.niveau === ui.filterNiveau;
                
                return matchesSearch && matchesNiveau;
            });

            // G√©n√©ration du tableau de progression
            const generateProgressionTable = () => {
                const niveaux = ['6√®me', '5√®me', '4√®me', '3√®me'];
                const progression = {};
                
                niveaux.forEach(niveau => {
                    progression[niveau] = sequences
                        .filter(seq => seq.niveau === niveau)
                        .sort((a, b) => parseInt(a.numeroSequence) - parseInt(b.numeroSequence));
                });
                
                return progression;
            };

            const getCompetences = () => {
                const ids = [...new Set(currentSequence.declinaisonsSelectionnees.map(d => parseInt(d.split('-')[0])))];
                const list = ui.currentCycle === 'Cycle 3' ? competencesCycle3 : competencesCycle4;
                return list.filter(c => ids.includes(c.id));
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-4">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <div className="flex justify-between items-center mb-4">
                                <div className="flex items-center gap-4">
                                    <div className="p-2 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl shadow-lg">
                                        <Icons.MusicLogo />
                                    </div>
                                    <div>
                                        <h1 className="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                                            Cr√©ateur de S√©quences Musicales
                                        </h1>
                                        <p className="text-xs text-gray-500">Cr√©√© par Julien Sang ‚Ä¢ Outil p√©dagogique pour l'enseignement musical</p>
                                    </div>
                                </div>
                                <button
                                    onClick={() => setUi({ ...ui, showForm: !ui.showForm, showCycleSelection: true, editingId: null })}
                                    className="flex items-center gap-2 bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700"
                                >
                                    {ui.showForm ? <Icons.X /> : <Icons.Plus />}
                                    {ui.showForm ? 'Fermer' : 'Nouvelle S√©quence'}
                                </button>
                            </div>
                            
                            {/* Barre de recherche et filtres */}
                            {!ui.showForm && sequences.length > 0 && (
                                <div className="mt-4 space-y-3">
                                    <div className="flex gap-2">
                                        <input
                                            type="text"
                                            placeholder="Rechercher dans les s√©quences..."
                                            value={ui.searchTerm}
                                            onChange={(e) => setUi({ ...ui, searchTerm: e.target.value })}
                                            className="flex-1 px-4 py-2 border rounded-lg"
                                        />
                                        <select 
                                            value={ui.filterNiveau || ''}
                                            onChange={(e) => setUi({ ...ui, filterNiveau: e.target.value })}
                                            className="px-4 py-2 border rounded-lg"
                                        >
                                            <option value="">Tous niveaux</option>
                                            <option value="6√®me">6√®me</option>
                                            <option value="5√®me">5√®me</option>
                                            <option value="4√®me">4√®me</option>
                                            <option value="3√®me">3√®me</option>
                                        </select>
                                        <button
                                            onClick={() => setUi({ ...ui, showProgression: !ui.showProgression })}
                                            className={`px-4 py-2 rounded-lg ${ui.showProgression ? 'bg-purple-700 text-white' : 'bg-purple-600 text-white hover:bg-purple-700'}`}
                                        >
                                            üìä Progression
                                        </button>
                                    </div>
                                    {(ui.searchTerm || ui.filterNiveau) && (
                                        <p className="text-sm text-gray-600">
                                            {filteredSequences.length} s√©quence(s) trouv√©e(s)
                                        </p>
                                    )}
                                </div>
                            )}

                            {/* Form */}
                            {ui.showForm && (
                                <div className="bg-gray-50 rounded-xl p-6 border-2 border-indigo-200">
                                    {ui.showCycleSelection ? (
                                        <div className="text-center py-8">
                                            <h2 className="text-2xl font-semibold mb-6">Choisissez le niveau</h2>
                                            <div className="grid md:grid-cols-2 gap-6 max-w-3xl mx-auto">
                                                <button onClick={() => handleSelectCycle('6√®me')} className="bg-white border-4 border-blue-400 rounded-xl p-8 hover:bg-blue-50">
                                                    <h3 className="text-3xl font-bold text-blue-600">6√®me</h3>
                                                    <p className="text-xl">Cycle 3</p>
                                                </button>
                                                <div className="bg-white border-4 border-purple-400 rounded-xl p-8">
                                                    <h3 className="text-2xl font-bold text-purple-600">Cycle 4</h3>
                                                    <div className="flex gap-2 justify-center mt-4">
                                                        {['5√®me', '4√®me', '3√®me'].map(n => (
                                                            <button key={n} onClick={() => handleSelectCycle(n)} 
                                                                className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-700">
                                                                {n}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ) : ui.showObjectifs ? (
                                        <div>
                                            <h2 className="text-2xl font-semibold mb-4">Objectifs et attendus de fin de cycle</h2>
                                            <div className="bg-yellow-50 p-3 mb-4 rounded">
                                                <p className="text-sm font-semibold">
                                                    S√©lectionnez 3 d√©clinaisons ({currentSequence.declinaisonsSelectionnees.length}/3)
                                                </p>
                                            </div>
                                            {objectifsFinCycle.map(obj => (
                                                <div key={obj.id} className="border rounded-lg mb-3">
                                                    <button onClick={() => setUi({ ...ui, expandedObjectif: ui.expandedObjectif === obj.id ? null : obj.id })}
                                                        className="w-full text-left p-4 hover:bg-gray-50">
                                                        <div className="flex justify-between">
                                                            <span><b>{obj.id}.</b> {obj.titre}</span>
                                                            {ui.expandedObjectif === obj.id ? <Icons.ChevronUp /> : <Icons.ChevronDown />}
                                                        </div>
                                                    </button>
                                                    {ui.expandedObjectif === obj.id && (
                                                        <div className="p-4 bg-gray-50">
                                                            {obj.declinaisons.map((dec, idx) => (
                                                                <label key={idx} className="flex items-start gap-3 p-2 hover:bg-white rounded cursor-pointer">
                                                                    <input type="checkbox"
                                                                        checked={currentSequence.declinaisonsSelectionnees.includes(`${obj.id}-${dec}`)}
                                                                        onChange={() => toggleDeclinaison('objectifs', obj.id, dec)}
                                                                        disabled={!currentSequence.declinaisonsSelectionnees.includes(`${obj.id}-${dec}`) && 
                                                                                 currentSequence.declinaisonsSelectionnees.length >= 3}
                                                                    />
                                                                    <span className="text-sm">{dec}</span>
                                                                </label>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                            <button onClick={() => currentSequence.declinaisonsSelectionnees.length === 3 && setUi({ ...ui, showObjectifs: false, showCompetences: true })}
                                                disabled={currentSequence.declinaisonsSelectionnees.length !== 3}
                                                className="w-full bg-indigo-600 text-white py-3 rounded-lg disabled:bg-gray-400">
                                                Continuer ‚Üí
                                            </button>
                                        </div>
                                    ) : ui.showCompetences ? (
                                        <div>
                                            <h2 className="text-2xl font-semibold mb-4">Comp√©tences travaill√©es</h2>
                                            <div className="bg-yellow-50 p-3 mb-4 rounded">
                                                <p className="text-sm font-semibold">
                                                    S√©lectionnez 3-4 d√©clinaisons ({currentSequence.competencesDeclinaisons.length}/4)
                                                </p>
                                            </div>
                                            {getCompetences().map(cat => (
                                                <div key={cat.id} className="border rounded-lg mb-3">
                                                    <button onClick={() => setUi({ ...ui, expandedCompetence: ui.expandedCompetence === cat.id ? null : cat.id })}
                                                        className="w-full text-left p-4 hover:bg-gray-50">
                                                        <div className="flex justify-between">
                                                            <span><b>{cat.id}.</b> {cat.categorie}</span>
                                                            {ui.expandedCompetence === cat.id ? <Icons.ChevronUp /> : <Icons.ChevronDown />}
                                                        </div>
                                                    </button>
                                                    {ui.expandedCompetence === cat.id && (
                                                        <div className="p-4 bg-gray-50">
                                                            {cat.competences.map((comp, idx) => (
                                                                <label key={idx} className="flex items-start gap-3 p-2 hover:bg-white rounded cursor-pointer">
                                                                    <input type="checkbox"
                                                                        checked={currentSequence.competencesDeclinaisons.includes(`${cat.id}-${comp}`)}
                                                                        onChange={() => toggleDeclinaison('competences', cat.id, comp)}
                                                                        disabled={!currentSequence.competencesDeclinaisons.includes(`${cat.id}-${comp}`) && 
                                                                                 currentSequence.competencesDeclinaisons.length >= 4}
                                                                    />
                                                                    <span className="text-sm">{comp}</span>
                                                                </label>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            ))}
                                            <button onClick={() => currentSequence.competencesDeclinaisons.length >= 3 && setUi({ ...ui, showCompetences: false })}
                                                disabled={currentSequence.competencesDeclinaisons.length < 3}
                                                className="w-full bg-indigo-600 text-white py-3 rounded-lg disabled:bg-gray-400">
                                                Continuer ‚Üí
                                            </button>
                                        </div>
                                    ) : (
                                        <div>
                                            <h2 className="text-2xl font-semibold mb-4">
                                                {ui.editingId ? '‚úèÔ∏è Modifier' : 'Nouvelle'} s√©quence - {currentSequence.niveau} ({currentSequence.cycle})
                                            </h2>
                                            <div className="grid md:grid-cols-2 gap-4 mb-6">
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Num√©ro de s√©quence</label>
                                                    <input type="number" value={currentSequence.numeroSequence}
                                                        onChange={(e) => setCurrentSequence({ ...currentSequence, numeroSequence: e.target.value })}
                                                        className="w-full px-4 py-2 border rounded-lg" min="1" />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">Dur√©e (s√©ances)</label>
                                                    <input type="number" value={currentSequence.duree}
                                                        onChange={(e) => setCurrentSequence({ ...currentSequence, duree: e.target.value })}
                                                        className="w-full px-4 py-2 border rounded-lg" min="1" max="12" />
                                                </div>
                                            </div>
                                            <div className="mb-6">
                                                <label className="block text-sm font-medium mb-2">Titre de la s√©quence</label>
                                                <input type="text" value={currentSequence.titre}
                                                    onChange={(e) => setCurrentSequence({ ...currentSequence, titre: e.target.value })}
                                                    className="w-full px-4 py-2 border rounded-lg" />
                                            </div>
                                            <div className="mb-6">
                                                <label className="block text-sm font-medium mb-2">
                                                    {ui.currentCycle === 'Cycle 3' ? 'Question directrice' : 'Probl√©matique'}
                                                </label>
                                                <input type="text" value={ui.currentCycle === 'Cycle 3' ? currentSequence.question : currentSequence.problematique}
                                                    onChange={(e) => setCurrentSequence({
                                                        ...currentSequence,
                                                        [ui.currentCycle === 'Cycle 3' ? 'question' : 'problematique']: e.target.value
                                                    })}
                                                    className="w-full px-4 py-2 border rounded-lg" />
                                            </div>
                                            <button onClick={() => setUi({ ...ui, showObjectifs: true })}
                                                className="w-full bg-indigo-600 text-white py-3 rounded-lg mb-6">
                                                D√©finir les objectifs ‚Üí
                                            </button>

                                            {currentSequence.competencesDeclinaisons.length > 0 && (
                                                <>
                                                    <div className="mt-6 p-4 bg-yellow-50 border-2 border-yellow-400 rounded-lg">
                                                        <h3 className="text-lg font-semibold mb-3 text-yellow-800">‚ö†Ô∏è Domaines techniques obligatoires</h3>
                                                        <p className="text-sm text-yellow-700 mb-2">Vous devez s√©lectionner au minimum :</p>
                                                        <ul className="text-sm text-yellow-700 list-disc list-inside">
                                                            <li className={currentSequence.domainesDeclinaisons.some(d => d.startsWith('1-')) ? 'text-green-700 font-semibold' : ''}>
                                                                {currentSequence.domainesDeclinaisons.some(d => d.startsWith('1-')) ? '‚úì' : '‚óã'} Au moins 1 √©l√©ment dans "Geste vocal"
                                                            </li>
                                                            <li className={currentSequence.domainesDeclinaisons.some(d => d.startsWith('2-')) ? 'text-green-700 font-semibold' : ''}>
                                                                {currentSequence.domainesDeclinaisons.some(d => d.startsWith('2-')) ? '‚úì' : '‚óã'} Au moins 1 √©l√©ment dans "Style"
                                                            </li>
                                                        </ul>
                                                    </div>

                                                    <h3 className="text-xl font-semibold mb-4 mt-6">Domaines techniques</h3>
                                                    {Object.entries(domainesTechniques).map(([id, domaine]) => {
                                                        const isRequired = id === '1' || id === '2';
                                                        const hasSelection = currentSequence.domainesDeclinaisons.some(d => d.startsWith(`${id}-`));
                                                        return (
                                                            <div key={id} className={`border-2 rounded-lg mb-3 ${isRequired && !hasSelection ? 'border-red-400' : 'border-gray-200'}`}>
                                                                <button onClick={() => setUi({ ...ui, expandedDomaine: ui.expandedDomaine === parseInt(id) ? null : parseInt(id) })}
                                                                    className={`w-full text-left p-4 ${hasSelection ? 'bg-green-50' : 'hover:bg-gray-50'}`}>
                                                                    <div className="flex justify-between">
                                                                        <span>
                                                                            <b>{id}.</b> {domaine.titre} 
                                                                            {isRequired && <span className="text-red-500 ml-2 text-sm font-bold">* Obligatoire</span>}
                                                                            {hasSelection && <span className="text-green-600 ml-2">‚úì</span>}
                                                                        </span>
                                                                        {ui.expandedDomaine === parseInt(id) ? <Icons.ChevronUp /> : <Icons.ChevronDown />}
                                                                    </div>
                                                                </button>
                                                                {ui.expandedDomaine === parseInt(id) && (
                                                                    <div className="p-4 bg-gray-50">
                                                                        {domaine.declinaisons.map((dec, idx) => (
                                                                            <label key={idx} className="flex items-start gap-3 p-2 hover:bg-white rounded cursor-pointer">
                                                                                <input type="checkbox"
                                                                                    checked={currentSequence.domainesDeclinaisons.includes(`${id}-${dec}`)}
                                                                                    onChange={() => toggleDeclinaison('domaines', id, dec)} />
                                                                                <span className="text-sm">{dec}</span>
                                                                            </label>
                                                                        ))}
                                                                    </div>
                                                                )}
                                                            </div>
                                                        );
                                                    })}

                                                    <div className="mt-6">
                                                        <h3 className="text-lg font-semibold mb-3">Vocabulaire</h3>
                                                        <div className="flex gap-2 mb-3">
                                                            <input type="text" value={newVocabulaire}
                                                                onChange={(e) => setNewVocabulaire(e.target.value)}
                                                                onKeyPress={(e) => e.key === 'Enter' && newVocabulaire.trim() && 
                                                                    (setCurrentSequence({ ...currentSequence, vocabulaire: [...currentSequence.vocabulaire, newVocabulaire.trim()] }), setNewVocabulaire(''))}
                                                                className="flex-1 px-4 py-2 border rounded-lg" placeholder="Ajouter un mot..." />
                                                            <button onClick={() => newVocabulaire.trim() && 
                                                                (setCurrentSequence({ ...currentSequence, vocabulaire: [...currentSequence.vocabulaire, newVocabulaire.trim()] }), setNewVocabulaire(''))}
                                                                className="bg-indigo-600 text-white px-4 py-2 rounded-lg">
                                                                <Icons.Plus />
                                                            </button>
                                                        </div>
                                                        <div className="flex flex-wrap gap-2">
                                                            {currentSequence.vocabulaire.map((mot, idx) => (
                                                                <span key={idx} className="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full flex items-center gap-2">
                                                                    {mot}
                                                                    <button onClick={() => setCurrentSequence({
                                                                        ...currentSequence,
                                                                        vocabulaire: currentSequence.vocabulaire.filter((_, i) => i !== idx)
                                                                    })} className="text-indigo-600">
                                                                        <Icons.X />
                                                                    </button>
                                                                </span>
                                                            ))}
                                                        </div>
                                                    </div>

                                                    <div className="mt-6">
                                                        <h3 className="text-lg font-semibold mb-3">≈íuvre de r√©f√©rence</h3>
                                                        <input type="text" value={currentSequence.oeuvreReference}
                                                            onChange={(e) => setCurrentSequence({ ...currentSequence, oeuvreReference: e.target.value })}
                                                            className="w-full px-4 py-2 border rounded-lg" 
                                                            placeholder="Ex: Symphonie n¬∞5 - Beethoven" />
                                                    </div>

                                                    <div className="mt-6">
                                                        <h3 className="text-lg font-semibold mb-3">≈íuvres compl√©mentaires (3 max)</h3>
                                                        {[0, 1, 2].map(idx => (
                                                            <input key={idx} type="text" 
                                                                value={currentSequence.oeuvresComplementaires[idx] || ''}
                                                                onChange={(e) => {
                                                                    const newOeuvres = [...currentSequence.oeuvresComplementaires];
                                                                    newOeuvres[idx] = e.target.value;
                                                                    setCurrentSequence({ ...currentSequence, oeuvresComplementaires: newOeuvres });
                                                                }}
                                                                className="w-full px-4 py-2 border rounded-lg mb-2" 
                                                                placeholder={`≈íuvre compl√©mentaire ${idx + 1} (optionnel)`} />
                                                        ))}
                                                    </div>

                                                    <div className="mt-6">
                                                        <h3 className="text-lg font-semibold mb-3">Projet musical</h3>
                                                        <textarea value={currentSequence.projetMusical}
                                                            onChange={(e) => setCurrentSequence({ ...currentSequence, projetMusical: e.target.value })}
                                                            className="w-full px-4 py-2 border rounded-lg h-24" 
                                                            placeholder="Description du projet musical..." />
                                                    </div>

                                                    <div className="mt-6">
                                                        <h3 className="text-lg font-semibold mb-3">Histoire des Arts</h3>
                                                        <textarea value={currentSequence.histoireDesArts}
                                                            onChange={(e) => setCurrentSequence({ ...currentSequence, histoireDesArts: e.target.value })}
                                                            className="w-full px-4 py-2 border rounded-lg h-24" 
                                                            placeholder="Liens avec l'histoire des arts..." />
                                                    </div>

                                                    <button onClick={handleSaveSequence}
                                                        className="w-full bg-green-600 text-white py-3 rounded-lg mt-6 hover:bg-green-700">
                                                        <Icons.Save /> Enregistrer la s√©quence
                                                    </button>
                                                </>
                                            )}
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>

                        {/* Tableau de progression annuelle */}
                        {ui.showProgression && (
                            <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-xl font-bold">üìä Tableau de progression annuelle</h2>
                                    <button
                                        onClick={() => setUi({ ...ui, showProgression: false })}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <Icons.X />
                                    </button>
                                </div>
                                
                                <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    {['6√®me', '5√®me', '4√®me', '3√®me'].map(niveau => {
                                        const seqNiveau = sequences
                                            .filter(seq => seq.niveau === niveau)
                                            .sort((a, b) => parseInt(a.numeroSequence) - parseInt(b.numeroSequence));
                                        
                                        return (
                                            <div key={niveau} className="border-2 border-gray-200 rounded-lg p-4">
                                                <h3 className={`text-lg font-bold mb-3 ${
                                                    niveau === '6√®me' ? 'text-blue-600' : 
                                                    niveau === '5√®me' ? 'text-green-600' :
                                                    niveau === '4√®me' ? 'text-orange-600' : 
                                                    'text-purple-600'
                                                }`}>
                                                    {niveau} ({seqNiveau.length} s√©quences)
                                                </h3>
                                                
                                                {seqNiveau.length === 0 ? (
                                                    <p className="text-gray-400 text-sm italic">Aucune s√©quence</p>
                                                ) : (
                                                    <div className="space-y-2">
                                                        {seqNiveau.map(seq => (
                                                            <div key={seq.id} className="bg-gray-50 rounded p-2">
                                                                <div className="flex items-start gap-2">
                                                                    <span className="bg-gray-600 text-white text-xs rounded px-1">
                                                                        {seq.numeroSequence}
                                                                    </span>
                                                                    <div className="flex-1">
                                                                        <p className="text-sm font-medium">{seq.titre}</p>
                                                                        <p className="text-xs text-gray-500">{seq.duree} s√©ances</p>
                                                                        {seq.question && (
                                                                            <p className="text-xs text-blue-600 mt-1">Q: {seq.question.substring(0, 50)}...</p>
                                                                        )}
                                                                        {seq.problematique && (
                                                                            <p className="text-xs text-purple-600 mt-1">P: {seq.problematique.substring(0, 50)}...</p>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        ))}
                                                        
                                                        {/* Calcul du total de s√©ances */}
                                                        <div className="border-t pt-2 mt-2">
                                                            <p className="text-xs font-semibold text-gray-600">
                                                                Total : {seqNiveau.reduce((sum, seq) => sum + parseInt(seq.duree || 0), 0)} s√©ances
                                                            </p>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                                
                                {/* R√©sum√© global */}
                                <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                                    <h3 className="font-semibold mb-2">R√©sum√© global</h3>
                                    <div className="grid md:grid-cols-4 gap-4 text-sm">
                                        <div>
                                            <span className="font-medium">Total s√©quences :</span> {sequences.length}
                                        </div>
                                        <div>
                                            <span className="font-medium">Total s√©ances :</span> {sequences.reduce((sum, seq) => sum + parseInt(seq.duree || 0), 0)}
                                        </div>
                                        <div>
                                            <span className="font-medium">Moyenne par s√©quence :</span> {
                                                sequences.length ? 
                                                Math.round(sequences.reduce((sum, seq) => sum + parseInt(seq.duree || 0), 0) / sequences.length) : 
                                                0
                                            } s√©ances
                                        </div>
                                        <div>
                                            <span className="font-medium">Niveaux couverts :</span> {
                                                [...new Set(sequences.map(s => s.niveau))].length
                                            }/4
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Liste des s√©quences */}
                        <div className="grid md:grid-cols-2 gap-6">
                            {filteredSequences.map(seq => (
                                <div key={seq.id} className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-indigo-600">
                                    <div className="flex justify-between items-start mb-3">
                                        <div>
                                            <span className="bg-indigo-600 text-white px-3 py-1 rounded-full text-sm">
                                                S√©quence {seq.numeroSequence}
                                            </span>
                                            <h3 className="text-xl font-bold mt-2">{seq.titre}</h3>
                                            <p className="text-sm text-gray-500">{seq.niveau} ‚Ä¢ {seq.duree} s√©ances</p>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={() => handleEditSequence(seq)}
                                                className="text-gray-500 hover:text-blue-600" title="Modifier">
                                                <Icons.Edit />
                                            </button>
                                            <button onClick={() => handleExportPDF(seq)}
                                                className="text-gray-500 hover:text-blue-600" title="T√©l√©charger PDF">
                                                <Icons.FileText />
                                            </button>
                                            <button onClick={() => handleDeleteSequence(seq.id, seq.titre)}
                                                className="text-gray-500 hover:text-red-600" title="Supprimer">
                                                <Icons.Trash2 />
                                            </button>
                                        </div>
                                    </div>
                                    {(seq.question || seq.problematique) && (
                                        <div className="bg-indigo-50 p-3 rounded mb-3">
                                            <p className="text-sm italic">{seq.question || seq.problematique}</p>
                                        </div>
                                    )}
                                    
                                    {seq.vocabulaire && seq.vocabulaire.length > 0 && (
                                        <div className="mt-3">
                                            <p className="text-sm font-semibold mb-1">Vocabulaire:</p>
                                            <div className="flex flex-wrap gap-1">
                                                {seq.vocabulaire.slice(0, 5).map((mot, i) => (
                                                    <span key={i} className="bg-gray-100 text-gray-700 px-2 py-1 rounded text-xs">{mot}</span>
                                                ))}
                                                {seq.vocabulaire.length > 5 && (
                                                    <span className="text-xs text-gray-500">+{seq.vocabulaire.length - 5} autres</span>
                                                )}
                                            </div>
                                        </div>
                                    )}
                                    
                                    {seq.oeuvreReference && (
                                        <div className="mt-2">
                                            <p className="text-sm font-semibold">≈íuvre de r√©f√©rence:</p>
                                            <p className="text-xs text-gray-600">{seq.oeuvreReference}</p>
                                        </div>
                                    )}
                                    
                                    {seq.projetMusical && (
                                        <div className="mt-2">
                                            <p className="text-sm font-semibold">Projet musical:</p>
                                            <p className="text-xs text-gray-600">{seq.projetMusical.substring(0, 50)}{seq.projetMusical.length > 50 ? '...' : ''}</p>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<MusicSequenceBuilder />, document.getElementById('root'));
    </script>
</body>
</html>